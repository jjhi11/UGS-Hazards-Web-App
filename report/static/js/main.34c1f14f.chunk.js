(this["webpackJsonpugs-hazards"]=this["webpackJsonpugs-hazards"]||[]).push([[0],{14:function(e,t,r){},16:function(e,t,r){},17:function(e,t,r){},29:function(e,t,r){},30:function(e,t,r){"use strict";r.r(t);var a,n,o=r(0),c=r.n(o),s=r(6),l=r.n(s),u=(r(14),r(1)),i=r.n(u),d=r(3),p=r(2),m=(r(16),"https://services.arcgis.com/ZzrwjTRez6FJiOq4/arcgis/rest/services"),h={notProd:!1,urls:{baseUrl:m,hazardGroupingsTable:"".concat(m,"/Report_Tables_View/FeatureServer/0"),hazardGroupTextTable:"".concat(m,"/Report_Tables_View/FeatureServer/1"),hazardIntroTextTable:"".concat(m,"/Report_Tables_View/FeatureServer/2"),hazardReferenceTextTable:"".concat(m,"/Report_Tables_View/FeatureServer/3"),hazardUnitTextTable:"".concat(m,"/Report_Tables_View/FeatureServer/4"),otherDataTable:"".concat(m,"/Report_Tables_View/FeatureServer/7"),reportTextTable:"".concat(m,"/Report_Tables_View/FeatureServer/8")},queries:[["Utah_Geologic_Hazards/FeatureServer/0","FLH"],["Utah_Geologic_Hazards/FeatureServer/1","SGS"],["Utah_Geologic_Hazards/FeatureServer/2","LSS"],["Utah_Geologic_Hazards/FeatureServer/3","LSF"],["Utah_Geologic_Hazards/FeatureServer/5","CAS"],["Utah_Geologic_Hazards/FeatureServer/6","CSS"],["Utah_Geologic_Hazards/FeatureServer/7","CRS"],["Utah_Geologic_Hazards/FeatureServer/8","EFH"],["Utah_Geologic_Hazards/FeatureServer/9","ERZ"],["Utah_Geologic_Hazards/FeatureServer/10","EXS"],["Utah_Geologic_Hazards/FeatureServer/11","GSP"],["Utah_Geologic_Hazards/FeatureServer/12","MKF"],["Utah_Geologic_Hazards/FeatureServer/13","PES"],["Utah_Geologic_Hazards/FeatureServer/14","GRS"],["Utah_Geologic_Hazards/FeatureServer/15","RFH"],["Utah_Geologic_Hazards/FeatureServer/16","SDH"],["Utah_Geologic_Hazards/FeatureServer/17","SBP"],["Utah_Geologic_Hazards/FeatureServer/18","SLS"],["Utah_Geologic_Hazards/FeatureServer/19","WSS"],["Utah_Earthquake_Hazards/FeatureServer/3","LQS"],["Utah_Earthquake_Hazards/FeatureServer/4","SFR"]],webMaps:{hazard:"895afaac7ee04933b91ee9dd1f88c823"}},f=r(7),b=Object(d.a)(i.a.mark((function e(){var t,r,a,n,o,c,s,l,u;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=["esri/WebMap","esri/views/MapView","esri/geometry/Polygon","esri/Graphic","esri/core/watchUtils","esri/symbols/support/symbolUtils"],e.next=3,Object(f.loadModules)(t,{css:!0});case 3:return r=e.sent,a=Object(p.a)(r,6),n=a[0],o=a[1],c=a[2],s=a[3],l=a[4],u=a[5],e.abrupt("return",{WebMap:n,MapView:o,Polygon:c,Graphic:s,watchUtils:l,symbolUtils:u});case 12:case"end":return e.stop()}}),e)}))),g=Object(o.createContext)({visualAssets:{}}),T=function(e){console.log("HazardMap.render",e);var t=Object(o.useState)({}),r=Object(p.a)(t,2),s=r[0],l=r[1],u=Object(o.useState)(!1),m=Object(p.a)(u,2),f=m[0],T=m[1],S=Object(o.useState)(!1),H=Object(p.a)(S,2),x=H[0],y=H[1],_=function(){var t=Object(d.a)(i.a.mark((function t(){var r,o,c,s,l,u,d,p,m;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return console.log("HazardMap.createMap"),T(!0),t.next=4,b();case 4:r=t.sent,o=r.WebMap,c=r.MapView,s=r.Polygon,l=r.Graphic,(u=document.createElement("div")).style="position: absolute; left: -5000px; width: 1000px; height: 500px",document.body.appendChild(u),d={type:"simple-line",color:[226,119,40],width:4},p=new s(e.aoi),m=new l({geometry:p,symbol:d}),a=new o({portalItem:{id:h.webMaps.hazard}}),console.log("map created"),(n=new c({map:a,container:u,ui:{components:["attribution"]},extent:p.extent.expand(3)})).graphics.add(m),y(!0);case 20:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}();return Object(o.useEffect)((function(){var t=function(){var t=Object(d.a)(i.a.mark((function t(){var r,a,n,o,c,s,u,d;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:r={},a=0;case 2:if(!(a<e.queriesWithResults.length)){t.next=13;break}return n=Object(p.a)(e.queriesWithResults[a],2),o=n[0],c=n[1],t.next=6,v(o);case 6:s=t.sent,u=s.screenshot,d=s.renderer,r[c]={mapImage:u.dataUrl,renderer:d};case 10:a++,t.next=2;break;case 13:l(r);case 14:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}();x&&e.queriesWithResults.length>0&&t()}),[e.queriesWithResults,x]),f||_(),c.a.createElement(c.a.Fragment,null,c.a.createElement(g.Provider,{value:{visualAssets:s}},e.children))},v=function(){var e=Object(d.a)(i.a.mark((function e(t){var r,o,c,s,l,u;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("HazardMap.getScreenshot"),e.next=3,a.when();case 3:o=0;case 4:if(!(o<a.layers.length)){e.next=15;break}if((c=a.layers.getItemAt(o)).visible=new RegExp("".concat(t,"$")).test("".concat(c.url,"/").concat(c.layerId)),!c.visible){e.next=11;break}return e.next=10,c.load();case 10:r=c.renderer;case 11:case 12:o++,e.next=4;break;case 15:return e.next=17,n.when();case 17:return e.next=19,b();case 19:return s=e.sent,l=s.watchUtils,e.next=23,l.whenFalseOnce(n,"updating");case 23:return e.next=25,n.takeScreenshot({width:2e3,height:1e3});case 25:return u=e.sent,e.abrupt("return",{screenshot:u,renderer:r});case 27:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),S=function(e){return c.a.createElement("div",{className:"page-break"},c.a.createElement("h1",{title:h.notProd&&"HazardGroupingsTable.HazardGroup"},e.name),c.a.createElement("p",{dangerouslySetInnerHTML:{__html:e.text},title:h.notProd&&"HazardGroupTextTable.Text"}),e.children)},H=function(e){console.log("Hazard.render",e);var t=Object(o.useContext)(g).visualAssets[e.code];return c.a.createElement("div",{className:"page-break"},c.a.createElement("h2",{title:h.notProd&&"HazardUnitTextTable.HazardName (from first unit)"},e.name),c.a.createElement("p",{dangerouslySetInnerHTML:{__html:e.introText},title:h.notProd&&"HazardIntroTextTable.Text"}),t&&c.a.createElement("img",{src:t.mapImage,alt:"map",style:{width:"100%",minHeight:"200px"}}),e.children)},x=function(e){return e.slice(-3).toUpperCase()},y=(r(17),function(e){console.log("HazardUnit",e);var t=Object(o.useState)(!1),r=Object(p.a)(t,2),a=r[0],n=r[1],s=Object(o.useRef)(null),l=Object(o.useContext)(g);return Object(o.useEffect)((function(){var t=function(){var t=Object(d.a)(i.a.mark((function t(r){var a,o,c,l;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return console.log("buildLegend",r),t.next=3,b();case 3:if(a=t.sent,o=a.symbolUtils,c=[],"unique-value"===r.type&&(c=r.uniqueValueInfos.filter((function(t){return t.value===e.HazardUnit}))),1===c.length){t.next=9;break}return t.abrupt("return");case 9:return l=c[0].symbol.clone(),t.next=12,o.renderPreviewHTML(l,{node:s.current});case 12:n(!0);case 13:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}();console.log("mapContext",l);var r=l.visualAssets[x(e.HazardUnit)];!a&&r&&t(r.renderer)}),[a,e.HazardUnit,l]),c.a.createElement("div",{className:"unit"},c.a.createElement("div",{className:"legend-container"},c.a.createElement("div",{ref:s,className:"legend"}),c.a.createElement("div",null,c.a.createElement("p",{dangerouslySetInnerHTML:{__html:e.Description},title:h.notProd&&"HazardUnitTextTable.Description"}),c.a.createElement("h4",null,"How to Use This Map"),c.a.createElement("p",{dangerouslySetInnerHTML:{__html:e.HowToUse},title:h.notProd&&"HazardUnitTextTable.HowToUse"}))))}),_=function(e){return console.log("References.render"),c.a.createElement(c.a.Fragment,null,c.a.createElement("h3",null,"References"),e.references&&e.references.length>0?e.references.map((function(e,t){return c.a.createElement("p",{key:t,dangerouslySetInnerHTML:{__html:e},title:h.notProd&&"HazardReferenceTextTable.Text"})})):c.a.createElement("p",null,"None"))},E=r(4),z=function(){var e=Object(d.a)(i.a.mark((function e(t,r){var a,n,o,c,s,l,u;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("QueryService.queryUnitsAsync"),a=Object(p.a)(t,2),n=a[0],o=a[1],c="".concat(o,"HazardUnit"),s={geometryType:"esriGeometryPolygon",geometry:JSON.stringify(r),returnGeometry:!1,outFields:c,f:"json"},e.next=6,fetch("".concat(h.urls.baseUrl,"/").concat(n,"/query?").concat(Object(E.stringify)(s)));case 6:return l=e.sent,e.next=9,l.json();case 9:return u=e.sent,e.abrupt("return",{units:u.features.map((function(e){return e.attributes[c]})),hazard:o,url:n});case 11:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}(),O=function(e){return e.map((function(e){return x(e)}))},w=function(){var e=Object(d.a)(i.a.mark((function e(t,r,a){var n,o,c;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n={where:r,outFields:a,f:"json"},e.next=3,fetch("".concat(t,"/query?").concat(Object(E.stringify)(n)));case 3:return o=e.sent,e.next=6,o.json();case 6:return c=e.sent,e.abrupt("return",c.features.map((function(e){return e.attributes})));case 8:case"end":return e.stop()}}),e)})));return function(t,r,a){return e.apply(this,arguments)}}(),j=function(e){console.log("QueryService.queryHazardUnitTableAsync");var t="HazardUnit IN ('".concat(e.join("','"),"')");return w(h.urls.hazardUnitTextTable,t,"HazardName,HazardUnit,HowToUse,Description")},U=function(e){console.log("QueryService.queryReferenceTableAsync"),e=O(e);var t="Hazard IN ('".concat(e.join("','"),"')");return w(h.urls.hazardReferenceTextTable,t,"Hazard,Text")},R=function(e){console.log("QueryService.queryIntroTextAsync"),e=O(e);var t="Hazard IN ('".concat(e.join("','"),"')");return w(h.urls.hazardIntroTextTable,t,"Hazard,Text")},G=function(e){console.log("QueryService.queryGroupingAsync"),e=O(e);var t="HazardCode IN ('".concat(e.join("','"),"')");return w(h.urls.hazardGroupingsTable,t,"HazardCode,HazardGroup")},F=function(e){console.log("QueryService.queryGroupTextAsync");var t="HazardGroup IN ('".concat(e.join("','"),"')");return w(h.urls.hazardGroupTextTable,t,"HazardGroup,Text")},I=function(){console.log("QueryService.queryReportTextTableAsync");return w(h.urls.reportTextTable,"1=1","Section,Text")},P=function(){console.log("QueryService.queryOtherDataTable");return w(h.urls.otherDataTable,"1=1","Data,Introduction,HowToUse,References_")},M=r(8),k=r.n(M),N=(r(29),function(e){var t=e.aoiDescription,r=(e.aoi,e.Introduction),a=e.Disclaimer;return c.a.createElement("div",{className:"cover-page"},c.a.createElement("div",{className:"header"},c.a.createElement("h1",null,"Utah Geological Survey"),c.a.createElement("img",{src:k.a,alt:"dnr logo",className:"logo"}),c.a.createElement("h3",null,"GEOLOGIC HAZARDS MAPPING AND DATA CUSTOM REPORT"),c.a.createElement("h3",{title:h.notProd&&'from "description" property of input data'},"for ",t)),c.a.createElement("p",{dangerouslySetInnerHTML:{__html:r},title:h.notProd&&"ReportTextTable.Text(Introduction)"}),"<map>",c.a.createElement("p",{dangerouslySetInnerHTML:{__html:a},title:h.notProd&&"ReportTextTable.Text(Disclaimer)"}))}),A=function(e){return console.log("SummaryPage.render",e),c.a.createElement("div",{className:"page-break"},c.a.createElement("div",{className:"header"},c.a.createElement("h1",null,"Report Summary")),c.a.createElement("p",{dangerouslySetInnerHTML:{__html:e.Top},title:h.notProd&&"ReportTextTable.Text(Top)"}),c.a.createElement("p",{dangerouslySetInnerHTML:{__html:e.Table1headingautogeneratedtable},title:h.notProd&&"ReportTextTable.Text(Table 1 heading...)"}),"<table>",c.a.createElement("p",{dangerouslySetInnerHTML:{__html:e.Table2headingautogeneratedtable},title:h.notProd&&"ReportTextTable.Text(Table 2 heading...)"}),"<table>",c.a.createElement("p",{dangerouslySetInnerHTML:{__html:e.Bottom},title:h.notProd&&"ReportTextTable.Text(Bottom)"}))},D=function(e){return c.a.createElement("div",{className:"page-break"},c.a.createElement("div",{className:"header"},c.a.createElement("h1",null,"OTHER DATA"),c.a.createElement("h2",null,e.Data)),c.a.createElement("p",{dangerouslySetInnerHTML:{__html:e.Introduction},title:h.notProd&&"OtherDataTable.Introduction"}),c.a.createElement("div",null,"<map>"),e.children,c.a.createElement("h4",null,"How To Use This Map"),c.a.createElement("p",{dangerouslySetInnerHTML:{__html:e.HowToUse},title:h.notProd&&"OtherDataTable.HowToUse"}),e.References_&&c.a.createElement(c.a.Fragment,null,c.a.createElement("h4",null,"References"),c.a.createElement("p",{dangerouslySetInnerHTML:{__html:e.References_},title:h.notProd&&"OtherDataTable.References_"})))},L=function(e){var t=Object(o.useState)({}),r=Object(p.a)(t,2),a=r[0],n=r[1],s=Object(o.useState)({}),l=Object(p.a)(s,2),u=l[0],m=l[1],f=Object(o.useState)(),b=Object(p.a)(f,2),g=b[0],v=b[1],E=Object(o.useState)(),O=Object(p.a)(E,2),w=O[0],M=O[1],k=Object(o.useState)([]),L=Object(p.a)(k,2),q=L[0],C=L[1],V=Object(o.useState)([]),Q=Object(p.a)(V,2),W=Q[0],J=Q[1],B=Object(o.useState)({}),Z=Object(p.a)(B,2),K=Z[0],X=Z[1],$=Object(o.useState)({}),Y=Object(p.a)($,2),ee=Y[0],te=Y[1];return Object(o.useEffect)((function(){var t=function(){var t=Object(d.a)(i.a.mark((function t(){var r,a,o,c,s,l,u,d,f,b,g,T,S,H,y,_,E,O;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return console.log("App.getData"),t.next=3,Promise.all(h.queries.map((function(t){return z(t,e.polygon)})));case 3:return r=t.sent,console.log("queried all units"),a=r.filter((function(e){return e.units.length>0})),o=Array.from(new Set(a.reduce((function(e,t){var r=t.units;return e.concat(r)}),[]))),C(a.map((function(e){return[e.url,e.hazard]}))),t.next=10,Promise.all([G(o),R(o),j(o),U(o),I(),P()]);case 10:return c=t.sent,s=Object(p.a)(c,6),l=s[0],u=s[1],d=s[2],f=s[3],b=s[4],g=s[5],T={},g.forEach((function(e){T[e.Data]=e})),te(T),S={},b.forEach((function(e){var t=e.Section,r=e.Text;S[t]=r})),X(S),H=Array.from(new Set(l.map((function(e){return e.HazardGroup})))),t.next=27,F(H);case 27:y=t.sent,_={},y.forEach((function(e){var t=e.HazardGroup,r=e.Text;return _[t]=r})),E={},d.forEach((function(e){var t=e.HazardUnit,r=e.HazardName,a=e.HowToUse,n=e.Description,o=x(t);E[o]||(E[o]=[]),E[o].push({HazardName:r,HowToUse:a,Description:n,HazardUnit:t})})),O={},l.forEach((function(e){var t=e.HazardCode,r=e.HazardGroup;O[r]||(O[r]=[]),O[r].push(t)})),m(E),n(O),v(u),M(f),J(_);case 39:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}();e.polygon&&t()}),[e.polygon]),c.a.createElement(c.a.Fragment,null,c.a.createElement("button",{className:"hide-for-print print-button",onClick:window.print},"Print Report"),c.a.createElement(N,Object.assign({aoiDescription:e.description},K)),c.a.createElement(A,K),c.a.createElement(T,{aoi:e.polygon,queriesWithResults:q},Object.keys(a).map((function(e){return c.a.createElement(S,{key:e,name:e,text:W[e]},g&&w&&u&&a[e].map((function(e){var t=g.filter((function(t){return t.Hazard===e}))[0],r=t?t.Text:null,a=w.filter((function(t){return t.Hazard===e})),n=u[e];return c.a.createElement(H,{name:n[0].HazardName,introText:r,key:e,code:e},n.map((function(e,t){return c.a.createElement(y,Object.assign({key:t},e))})),c.a.createElement(_,{references:a.map((function(e){return e.Text}))}))})))}))),c.a.createElement(D,ee["Lidar Elevation Data"],"<lidar-specific stuff>"),c.a.createElement(D,ee["Aerial Photography and Imagery"],"<imagery-specific stuff>"),c.a.createElement("div",{className:"header page-break"},c.a.createElement("h1",null,"OTHER GEOLOGIC HAZARD RESOURCES"),c.a.createElement("p",{dangerouslySetInnerHTML:{__html:K.OtherResources},title:h.notProd&&"ReportTextTable.Text(OtherResources)"})))};console.log("app version: ".concat("0.1.0")),console.log("environment: ".concat("production"));var q=function(e){console.log("aoi",e),l.a.render(c.a.createElement(L,e),document.getElementById("root"))},C=localStorage.getItem("aoi");C?q(JSON.parse(C)):r.e(3).then(r.t.bind(null,31,3)).then((function(e){return q(e)}))},8:function(e,t,r){e.exports=r.p+"static/media/ugs-logo.46881887.jpg"},9:function(e,t,r){e.exports=r(30)}},[[9,1,2]]]);
//# sourceMappingURL=main.34c1f14f.chunk.js.map